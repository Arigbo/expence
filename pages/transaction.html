<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard</title>
    <link rel="stylesheet" href="/style/custom.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="shortcut icon" href="/Logomark.png" type="image/x-icon" />
  </head>
  <body>
    <div class="dashboard">
      <nav class="navbar">
        <div class="navbar_inner">
          <div class="top">
            <div><img src="/Logomark.png" alt="" /></div>
            <h1 class="">Spen<span>track</span></h1>
          </div>
          <a href="./index.html" class="dash"
            ><i class="fas fa-cube"></i> Dashboard</a
          ><a href="/pages/transaction.html" class="transaction"
            ><i class="fas fa-exchange-alt"></i> Transactions</a
          >
          <a href="./budget.html" class="budget"
            ><i class="fas fa-rocket"></i> Budgets</a
          >
          <a href="/" class="report"
            ><i class="fas fa-chart-line"></i> Reports</a
          >
          <a href="/" class="setting"><i class="fas fa-gear"></i> Setting</a>
        </div>
      </nav>
      <div class="dashboard_header">
        <div class="left">
          <div class="left_left">
            <i class="far fa-user"></i>
          </div>
          <div class="left_right">
            <h1>Hello</h1>
            <h4>Chally Pepper</h4>
          </div>
        </div>
        <div class="right">
          <i class="far fa-bell"></i>
        </div>
      </div>
      <div class="dashboard_header desktop">
        <div class="left">
          <i class="fas fa-bars bar"></i>
        </div>
        <div class="middle">
          <div class="middle_left">
            <p>Hello Colins, good morning!</p>
          </div>
          <div class="middle_right">
            <i class="fas fa-search"></i>
            <input type="search" placeholder="Search here...." />
          </div>
        </div>
        <div class="right">
          <div class="right_left">
            <h1><i class="far fa-bell"></i></h1>
          </div>
          <div class="right_right">
            <i class="fas fa-user"></i>
          </div>
        </div>
      </div>
      <div class="transaction_inner">
        <div class="single_transact"></div>
        <section class="fourth">
          <header>
            <h1>Transactions</h1>
            <div class="right">
              <i class="fas fa-sort"></i>
              <div class="sort">
                <select id="filter" onchange="filterTransactions()">
                  <option value="all">All</option>
                  <option value="day">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                  <option value="year">This Year</option>
                  <option value="recent">Most Recent</option>
                  <option value="oldest">Oldest</option>
                  <option value="expenses">Expenses</option>
                  <option value="income">Income</option>
                </select>
                <script>
                  async function fetchTransactions() {
                    const response = await fetch("/db.json");
                    const data = await response.json();
                    return data.transactions; // Assuming transactions are stored in a "transactions" array
                  }

                  async function filterTransactions() {
                    const filter = document.getElementById("filter").value;
                    const transactions = await fetchTransactions();
                    let filteredTransactions = [];

                    const now = new Date();
                    switch (filter) {
                      case "day":
                        filteredTransactions = transactions.filter(
                          (transaction) => {
                            const transactionDate = new Date(transaction.date);
                            return (
                              transactionDate.toDateString() ===
                              now.toDateString()
                            );
                          }
                        );
                        break;
                      case "week":
                        const startOfWeek = new Date(now);
                        startOfWeek.setHours(0, 0, 0, 0); // Reset time to midnight
                        startOfWeek.setDate(now.getDate() - now.getDay());
                        filteredTransactions = transactions.filter(
                          (transaction) => {
                            const transactionDate = new Date(transaction.date);
                            return (
                              transactionDate >= startOfWeek &&
                              transactionDate <= now
                            );
                          }
                        );
                        break;
                      case "month":
                        filteredTransactions = transactions.filter(
                          (transaction) => {
                            const transactionDate = new Date(transaction.date);
                            return (
                              transactionDate.getMonth() === now.getMonth() &&
                              transactionDate.getFullYear() ===
                                now.getFullYear()
                            );
                          }
                        );
                        break;
                      case "year":
                        filteredTransactions = transactions.filter(
                          (transaction) => {
                            const transactionDate = new Date(transaction.date);
                            return (
                              transactionDate.getFullYear() ===
                              now.getFullYear()
                            );
                          }
                        );
                        break;
                      case "recent":
                        filteredTransactions = [...transactions].sort(
                          (a, b) => new Date(b.date) - new Date(a.date)
                        );
                        break;
                      case "oldest":
                        filteredTransactions = [...transactions].sort(
                          (a, b) => new Date(a.date) - new Date(b.date)
                        );
                        break;
                      case "expenses":
                        filteredTransactions = transactions.filter(
                          (transaction) => transaction.type === "expense"
                        );
                        break;
                      case "income":
                        filteredTransactions = transactions.filter(
                          (transaction) => transaction.type === "income"
                        );
                        break;
                      default:
                        filteredTransactions = transactions;
                    }

                    displayTransactions(filteredTransactions);
                  }

                  function displayTransactions(transactions) {
                    const transactsContainer =
                      document.querySelector(".transacts");
                    transactsContainer.innerHTML = ""; // Clear existing transactions

                    const header = document.createElement("div");
                    header.classList.add("transaction-header", "sticky-header");
                    header.innerHTML = `
      <div>Date</div>
      <div>Description</div>
      <div>Category</div>
      <div>Type</div>
      <div>Amount</div>
      `;
                    transactsContainer.appendChild(header);

                    const groupedByYear = transactions.reduce(
                      (acc, transaction) => {
                        const year = new Date(transaction.date).getFullYear();
                        if (!acc[year]) acc[year] = [];
                        acc[year].push(transaction);
                        return acc;
                      },
                      {}
                    );

                    const sortedYears = Object.keys(groupedByYear).sort(
                      (a, b) => b - a
                    );
                    for (const year of sortedYears) {
                      const yearContainer = document.createElement("div");
                      yearContainer.classList.add("year-group", "sticky-year");
                      yearContainer.innerHTML = `<h2>${year}</h2>`;

                      const groupedByMonth = groupedByYear[year].reduce(
                        (acc, transaction) => {
                          const month = new Date(
                            transaction.date
                          ).toLocaleString("default", { month: "long" });
                          if (!acc[month]) acc[month] = [];
                          acc[month].push(transaction);
                          return acc;
                        },
                        {}
                      );

                      const sortedMonths = Object.keys(groupedByMonth).sort(
                        (a, b) => {
                          const monthA = new Date(`${a} 1, ${year}`);
                          const monthB = new Date(`${b} 1, ${year}`);
                          return monthB - monthA;
                        }
                      );

                      for (const month of sortedMonths) {
                        const monthContainer = document.createElement("div");
                        monthContainer.classList.add(
                          "month-group",
                          "sticky-month"
                        );
                        monthContainer.innerHTML = `<h3>${month}</h3>`;

                        groupedByMonth[month].forEach((transaction) => {
                          const transactionElement =
                            document.createElement("div");
                          transactionElement.classList.add("transaction");
                          transactionElement.innerHTML = `
      <div class="transaction-item ${transaction.type}">
      <div class="day">${new Date(transaction.date).toLocaleString("default", {
        weekday: "short",
      })} / ${new Date(transaction.date).getDate()}</div>
      <div>${transaction.description}</div>
      <div>${transaction.category}</div>
      <div>${transaction.type}</div>
      <div class="amount">$${transaction.amount}</div>
      </div>
      `;
                          transactionElement.addEventListener("click", () => {
                            renderSingleTransaction(transaction);
                          });
                          monthContainer.appendChild(transactionElement);
                        });

                        yearContainer.appendChild(monthContainer);
                      }

                      transactsContainer.appendChild(yearContainer);
                    }
                  }

                  function renderSingleTransaction(transaction) {
                    const singleTransactContainer =
                      document.querySelector(".single_transact");
                    singleTransactContainer.innerHTML = `
      <div class="transaction-detail">
   <div class="close">
   <i class=" close-btn fas fa-times"></i>
    </div>
      <h2>Transaction Details</h2>
      <div class="detail-row"><strong>Date:</strong> <span>${new Date(
        transaction.date
      ).toLocaleDateString()}</span></div>
      <div class="detail-row"><strong>Description:</strong> <span>${
        transaction.description
      }</span></div>
      <div class="detail-row"><strong>Category:</strong> <span>${
        transaction.category
      }</span></div>
      <div class="detail-row">
        <strong>Type:</strong>
        <span class="type-detail ${
          transaction.type
        }" style="background-color: ${
                      transaction.type === "expense" ? "#d32f2f" : "#388e3c"
                    };">
          ${transaction.type}
        </span>
      </div>
      <div class="detail-row"><strong>Amount:</strong> <span>$${
        transaction.amount
      }</span></div>
      </div>
      `;
                    singleTransactContainer.style.display = "flex"; // Ensure it is visible

                    document
                      .querySelector(".close-btn")
                      .addEventListener("click", () => {
                        singleTransactContainer.style.display = "none";
                      });
                  }

                  // Initial load
                  filterTransactions();
                </script>
                <style lang="scss">
                  select#filter {
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 5px;
                    font-size: 14px;
                    margin-bottom: 10px;
      
                  }

                  .transaction-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    font-weight: 500;
                    position: sticky;
                    top: 0rem;
                    z-index: 1;
                    height: 2rem;
                    background-color: white;

                    div {
                      flex: 1;
                      text-align: center;
                    }
                  }

                  .transaction-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin: 5px 0;
                    border-radius: 5px;
                    color: #fff;
                    height: 3rem;
                    padding: 0.2rem 0.5rem;
                    font-size: 14px;
                    font-weight: 500;

                    &.income {
                      background-color: #388e3c;
                      text-transform: capitalize;
                    }

                    &.expense {
                      background-color: #d32f2f;
                      text-transform: capitalize;
                    }

                    div {
                      flex: 1;
                      text-align: center;
                    }
                  }

                  .transaction-item {
                    &.amount {
                      display: block;
                    }
                  }

                  .transacts {
                    max-height: 100vh;
                    overflow-y: auto;
                    width: 100%; /* Ensure it spans the full width */
                    box-sizing: border-box; /* Include padding and border in width */
                  }

                  @media (max-width: 768px) {
                    .transacts {
                      max-height: 150vh; /* Adjust height for smaller screens */
                      overflow-y: scroll; /* Ensure scrolling works on mobile */
                      padding: 0 10px; /* Add padding for better spacing */
                    }
                  }

                  .year-group {
                    h2 {
                      margin: 10px 0;
                      color: #333;
                    }
                  }

                  .month-group {
                    h3 {
                      margin: 10px 0;
                      color: #333;
                    }
                    &:not(:has(.transaction)) {
                      display: none;
                    }
                  }

                  @media (max-width: 768px) {
                    .transaction-item {
                      flex-direction: column;
                      align-items: flex-start;

                      div {
                        text-align: left;
                        margin-bottom: 5px;
                      }
                    }

                    .transaction-item .amount {
                      text-align: left;
                      font-weight: bold;
                      margin-top: 5px;
                      width: 100%; /* Ensure it spans the full width */
                      display: block; /* Ensure it is displayed properly */
                      word-wrap: break-word; /* Handle long amounts */
                    }

                    .transaction-header {
                      display: none;
                      flex-direction: column;
                      align-items: flex-start;

                      div {
                        text-align: left;
                        margin-bottom: 5px;
                      }
                    }

                    .year-group {
                      display: flex;
                      flex-direction: column; /* Arrange years in descending order */
                    }

                    .month-group {
                      display: flex;
                      flex-direction: column; /* Arrange months in descending order */
                    }
                  }

                  .single_transact {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.8);
                    display: none; /* Initially hidden */
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;

                    .transaction-detail {
                      display: flex;
                      flex-direction: column;
                      align-items: center;
                      justify-content: center;
                      background-color: #fff;
                      padding: 20px;
                      border-radius: 0.3rem;
                      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                      max-width: 400px;
                      width: 90%;
                      height: 20rem;
                      font-family: Arial, sans-serif;
                      .close {
                        display: flex;
                        align-items: end;
                        justify-content: end;
                        width: 100%;

                        height: 3rem;
                        i {
                          width: 2rem;
                          height: 100%;
                          background-color: red;
                          display: flex;
                          align-items: center;
                          justify-content: center;
                          color: white;
                          font-size: 1rem;
                          border-radius: 0.2rem;
                          cursor: pointer;
                        }
                      }
                      h2 {
                        text-align: center;
                        margin-bottom: 20px;
                        color: #333;
                      }

                      .detail-row {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin: 10px 0;
                        font-size: 14px;
                        color: #555;
                        height: 2rem;
                        width: 100%;

                        strong {
                          text-align: left;
                          font-size: 14px;
                          font-weight: 600;
                        }

                        span {
                          text-align: right;
                          font-weight: 500;
                          font-size: 14px;
                          &.type-detail {
                            height: 2rem;
                            padding-inline: 0.3rem;
                            color: white;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            text-transform: capitalize;
                            border-radius: 0.2rem;
                            font-size: 14px;
                            font-weight: 400;
                          }
                        }
                      }
                    }
                  }
                </style>
              </div>
            </div>
          </header>
          <div class="fourth_inner">
            <div class="transacts"></div>
          </div>
        </section>
      </div>
    </div>
  </body>
  <script>
    document.querySelector(".fa-sort").addEventListener("click", () => {
      document.querySelector(".sort").classList.add("show");
    });
    document.querySelector(".navbar").addEventListener("click", function (e) {
      document.querySelector(".navbar").classList.remove("show");
    });
    document.querySelector(".bar").addEventListener("click", function (e) {
      document.querySelector(".navbar").classList.add("show");
    });
    // Sample expense and income data
    // Fetch transactions from db.json

    localStorage.setItem("page", "transaction");
    let page = localStorage.getItem("page");
    document.querySelector(".dash").addEventListener("click", function (e) {
      document.querySelector(".dash").classList.add("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
      return localStorage.setItem("page", "dashb");
    });
    if (page && page === "dashb") {
      document.querySelector(".dash").classList.add("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
    }

    document
      .querySelector(".transaction")
      .addEventListener("click", function (e) {
        document.querySelector(".dash").classList.remove("active");
        document.querySelector(".transaction").classList.add("active");
        document.querySelector(".budget").classList.remove("active");
        document.querySelector(".report").classList.remove("active");
        document.querySelector(".setting").classList.remove("active");
        return localStorage.setItem("page", "transaction");
      });
    if (page && page === "transaction") {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.add("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
    }

    document.querySelector(".budget").addEventListener("click", function (e) {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.add("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
      return localStorage.setItem("page", "budget");
    });
    if (page && page === "budget") {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.add("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
    }

    document.querySelector(".report").addEventListener("click", function (e) {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.add("active");
      document.querySelector(".setting").classList.remove("active");
      return localStorage.setItem("page", "report");
    });
    if (page && page === "report") {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.add("active");
      document.querySelector(".setting").classList.remove("active");
    }

    document.querySelector(".setting").addEventListener("click", function (e) {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.add("active");
      return localStorage.setItem("page", "setting");
    });
    if (page && page === "setting") {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.add("active");
    }
  </script>
</html>
