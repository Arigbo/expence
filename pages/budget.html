<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Budget and Goals</title>
    <link rel="stylesheet" href="/style/custom.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="shortcut icon" href="/Logomark.png" type="image/x-icon" />
  </head>
  <body>
    <div class="dashboard">
      <nav class="navbar">
        <div class="navbar_inner">
          <div class="top">
            <div><img src="/Logomark.png" alt="" /></div>
            <h1 class="">Spen<span>track</span></h1>
          </div>
          <a href="./index.html" class="dash"
            ><i class="fas fa-cube"></i> Dashboard</a
          ><a href="/pages/transaction.html" class="transaction"
            ><i class="fas fa-exchange-alt"></i> Transactions</a
          >
          <a href="./budget.html" class="budget"
            ><i class="fas fa-rocket"></i> Budgets</a
          >
          <a href="/" class="report"
            ><i class="fas fa-chart-line"></i> Reports</a
          >
          <a href="/" class="setting"><i class="fas fa-gear"></i> Setting</a>
        </div>
      </nav>
      <div class="dashboard_header">
        <div class="left">
          <div class="left_left">
            <a href="./profile.html"> <i class="far fa-user"></i></a>
          </div>
          <div class="left_right">
            <h1>Welcome</h1>
            <a href="profile.html" id="loggedInUser">Guest</a>
          </div>
        </div>
        <div class="right">
          <a href="./notifications.html">
            <i class="far fa-bell"></i>
            <div class="no_of_noties"></div
          ></a>
        </div>
      </div>
      <div class="dashboard_header desktop">
        <div class="left">
          <i class="fas fa-bars bar"></i>
        </div>
        <div class="middle">
          <div class="middle_left">
            <p>
              Hello <span id="loggedInUserMiddle">Guest</span>, good morning!
            </p>
          </div>
          <script>
            //  const loggedInId = Number(
            //     JSON.parse(localStorage.getItem("loggedin_id"))
            //   );
            //   const isLoggedIn = JSON.parse(localStorage.getItem("isLoggedIn"));
            const loggedInId = localStorage.getItem("loggedin_id")
              ? Number(localStorage.getItem("loggedin_id"))
              : null;
            const isLoggedIn = localStorage.getItem("isLoggedIn") === "true";

            async function fetchUserName() {
              if (!isLoggedIn || !loggedInId) {
                console.error("User is not logged in or no loggedin_id found");
                return "Guest";
              }
              try {
                const response = await fetch("/db.json");
                if (!response.ok) {
                  throw new Error("Failed to fetch db.json");
                }
                const data = await response.json();
                if (!data || !data.users) {
                  console.error("Users data not found in db.json");
                  return "Guest";
                }
                const user = data.users.find(
                  (u) => Number(u.id) === Number(loggedInId)
                );
                return user ? user.name : "Guest";
              } catch (error) {
                console.error("Error fetching user data:", error);
                return "Guest";
              }
            }

            fetchUserName().then((name) => {
              document.getElementById("loggedInUser").textContent = name;
              document.getElementById("loggedInUserMiddle").textContent = name;
            });
          </script>
          <div class="middle_right">
            <i class="fas fa-search"></i>
            <input type="search" placeholder="Search here...." />
          </div>
        </div>
        <div class="right">
          <div class="right_left">
            <a href="./notifications.html"
              ><i class="far fa-bell"></i>
              <div class="no_of_noties"></div
            ></a>
          </div>
          <script>
            document.addEventListener("DOMContentLoaded", async () => {
              const loggedInId = localStorage.getItem("loggedin_id");
              if (!loggedInId) {
                document.querySelector(".profile").classList.add("hide");
                return;
              }
              try {
                const response = await fetch("/db.json");
                const data = await response.json();

                const notifications = data.notifications.filter(
                  (notifications) =>
                    notifications.user_id === parseInt(loggedInId)
                );
                const read = notifications.filter(
                  (notifications) => notifications.read === false
                );
                if (notifications) {
                  document
                    .querySelectorAll(".no_of_noties")
                    .forEach((element) => {
                      if (read.length == 0) {
                        element.classList.add("hide");
                      }
                      element.innerHTML = `
                        ${read.length}
                    `;
                    });
                } else {
                  document.querySelectorAll(".profiles").innerHTML =
                    "<p>User not found.</p>";
                }
              } catch (error) {
                console.error("Error fetching user data:", error);
                document.getElementById("profiles").innerHTML =
                  "<p>Error loading user data.</p>";
              }
            });
          </script>
          <div class="right_right">
            <a href="./profile.html"> <i class="fas fa-user"></i></a>
          </div>
        </div>
      </div>
      <div class="goal">
        <div class="goal_form">
          <form action="">
            <!-- name of goal -->
            <!-- about goal -->
            <!-- amount needed to achieve goal -->
            <!-- alone on goal or with ppl, use an @to add ppl-->
            <!-- date to end goal -->
          </form>
        </div>
        <div class="goal_inner">
          <div class="goal_inner_top">
            <div class="left">
              <h1>Goals</h1>
            </div>
            <!-- Add goal -->
            <!-- Delete all -->
          </div>
          <div class="goal_inner_bottom">
            <div class="box">
              <div class="box_inner">
                <div class="left">
                  <input type="checkbox" name="" id="" />
                  <h1>goal name</h1>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="budget">
        <div class="budget_form">
          <form action="">
            <!-- name of budget -->
            <!-- about budget -->
            <!-- type of expense youre budgetting (from the type of budget we will estimate through transact history amount youve spent in achieve that budget or used in that expense yearly)-->
            <!--how much and how often do you plan on using the money budgetted daily, weekly,  monthly, yearly (optional for how often and also if user total balance isnt enough to achieve budget ask if user wishes to go ahead)-->
            <!-- alone on budget or with ppl, use an @to add ppl-->
            <!-- date to end (you can choose not certain) -->
            <!-- send a notification a with a lert of the new notification -->
          </form>
        </div>
        <div class="budget_inner">
          <div class="budget_inner_top">
            <div class="left">
              <h1>Goals</h1>
            </div>
            <!-- Add budget -->
            <!-- Delete all budget -->
             <!-- Total balance and budget -->
          </div>
          <div class="budget_inner_bottom">
            <div class="box">
              <div class="box_inner">
                <div class="left">
                  <input type="checkbox" name="" id="" />
                  <h1>budget name</h1>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    localStorage.setItem("page", "dashb");
    let page = localStorage.getItem("page");
    document.querySelector(".dash").addEventListener("click", function (e) {
      document.querySelector(".dash").classList.add("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
      return localStorage.setItem("page", "dashb");
    });
    if (page && page === "dashb") {
      document.querySelector(".dash").classList.add("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
    }

    document
      .querySelector(".transaction")
      .addEventListener("click", function (e) {
        document.querySelector(".dash").classList.remove("active");
        document.querySelector(".transaction").classList.add("active");
        document.querySelector(".budget").classList.remove("active");
        document.querySelector(".report").classList.remove("active");
        document.querySelector(".setting").classList.remove("active");
        return localStorage.setItem("page", "transaction");
      });
    if (page && page === "transaction") {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.add("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
    }

    document.querySelector(".budget").addEventListener("click", function (e) {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.add("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
      return localStorage.setItem("page", "budget");
    });
    if (page && page === "budget") {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.add("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.remove("active");
    }

    document.querySelector(".report").addEventListener("click", function (e) {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.add("active");
      document.querySelector(".setting").classList.remove("active");
      return localStorage.setItem("page", "report");
    });
    if (page && page === "report") {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.add("active");
      document.querySelector(".setting").classList.remove("active");
    }
    document.querySelector(".setting").addEventListener("click", function (e) {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.add("active");
      return localStorage.setItem("page", "setting");
    });
    if (page && page === "setting") {
      document.querySelector(".dash").classList.remove("active");
      document.querySelector(".transaction").classList.remove("active");
      document.querySelector(".budget").classList.remove("active");
      document.querySelector(".report").classList.remove("active");
      document.querySelector(".setting").classList.add("active");
    }

    document.querySelector(".navbar").addEventListener("click", function () {
      document.querySelector(".navbar").classList.remove("show");
    });

    document.querySelector(".bar").addEventListener("click", function () {
      document.querySelector(".navbar").classList.add("show");
    });
  </script>
</html>
